{"version":3,"file":"aja.js","sources":["../src/utils/util.ts","../src/store.ts","../src/aja.ts"],"sourcesContent":["/**\r\n * [title]=\"title\"\r\n * @param value\r\n */\r\nexport function attrp(value: string) {\r\n  return /^\\[\\w.+\\]$/.test(value);\r\n}\r\n\r\n/**\r\n * (click)=\"hello('hello')\"\r\n */\r\nexport function eventp(value: string) {\r\n  return /^\\(\\w.+\\)$/.test(value);\r\n}\r\n\r\n/**\r\n * #input 模板变量\r\n * @param value\r\n */\r\nexport function tempvarp(value: string) {\r\n  return value[0] === \"#\";\r\n}\r\n\r\nexport function createRoot(view: string | HTMLElement): HTMLElement | null {\r\n  return typeof view === \"string\"\r\n    ? document.querySelector<HTMLElement>(view)\r\n    : view;\r\n}\r\n\r\nexport function createIfCommentData(value: any): string {\r\n  return `{\":if\": \"${!!value}\"}`;\r\n}\r\n\r\nexport function createForCommentData(array: any[]): string {\r\n  return `{\":for\": \"${array}\"}`;\r\n}\r\n\r\nexport function ifp(key: string, prefix: string): boolean {\r\n  return key === prefix + \"if\";\r\n}\r\n\r\nexport function forp(key: string, prefix: string): boolean {\r\n  return key === prefix + \"for\";\r\n}\r\n\r\nexport function createObject<T>(obj?: T): T {\r\n  return obj ? obj : ({} as T);\r\n}\r\n\r\nexport const emptyString: string = \"\";\r\n\r\nexport function isNumber(str: string): boolean {\r\n  if (typeof str === \"number\") return true;\r\n  if (str && !str.trim()) return false;\r\n  return !isNaN(+str);\r\n}\r\n\r\n/**\r\n * 'name'  \"name\"\r\n *\r\n */\r\nexport function isTemplateString(str: string): boolean {\r\n  return /^['\"`]/.test(str.trim());\r\n}\r\n\r\n/**\r\n * '       '\r\n * @param str\r\n */\r\nexport function isTemplateEmptyString(str: string): boolean {\r\n  return !str.trim();\r\n}\r\n\r\n/**\r\n * setAge( obj.age   , '        ') -> [\"obj.age   \", \" '        '\"]\r\n * @param str\r\n */\r\nexport function parseTemplateEventArgs(str: string) {\r\n  let index = str.indexOf(\"(\");\r\n  return str\r\n    .substr(index, str.length - 2)\r\n    .replace(/(^\\(*)|(\\)$)/g, emptyString)\r\n    .trim()\r\n    .split(\",\");\r\n}\r\n","const l = console.log;\r\n\r\n/**\r\n * state 对象\r\n */\r\nexport interface State {\r\n  [key: string]: any;\r\n}\r\n\r\n/**\r\n * 事件函数\r\n */\r\nexport interface Actions {\r\n  [key: string]: any;\r\n}\r\n\r\n/**\r\n * 计算函数\r\n */\r\nexport interface Computeds {\r\n  [key: string]: Function;\r\n}\r\n\r\nexport interface Options {\r\n  state: State;\r\n  actions?: Actions;\r\n  computeds: Computeds;\r\n}\r\n\r\nexport const autorun = (f: Function) => {\r\n  f();\r\n  Store.autorunListeners.push(f);\r\n};\r\n\r\nexport class Store {\r\n\r\n  /**\r\n   * * 任意一个属性的变化，都会触发所有的监听事件\r\n   */\r\n  static autorunListeners: Function[] = [];\r\n  public $actions!: Actions;\r\n\r\n  constructor({ state, computeds, actions }: Options) {\r\n    for (const k in state) {\r\n      Object.defineProperty(this, k, {\r\n        get() {\r\n          let value = state[k];\r\n          if (typeof state[k] === \"object\") {\r\n            value = new Store({\r\n              state: value,\r\n              computeds: {}\r\n            });\r\n          }\r\n          return value;\r\n        },\r\n        set(newValue) {\r\n          state[k] = newValue;\r\n\r\n          for (const f of Store.autorunListeners) {\r\n            f();\r\n          }\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n      });\r\n    }\r\n\r\n    for (const k in computeds) {\r\n      Object.defineProperty(this, k, {\r\n        get() {\r\n          return computeds[k].call(this);\r\n        },\r\n        enumerable: true\r\n      });\r\n    }\r\n    if (actions) {\r\n      this.$actions = actions;\r\n    }\r\n  }\r\n}\r\n","import {\r\n  attrp,\r\n  eventp,\r\n  tempvarp,\r\n  createRoot,\r\n  createIfCommentData,\r\n  createObject,\r\n  emptyString,\r\n  isNumber,\r\n  isTemplateString,\r\n  parseTemplateEventArgs,\r\n  isTemplateEmptyString\r\n} from \"./utils/util\";\r\nimport { Store, autorun } from \"./store\";\r\n\r\n/**\r\n * state 对象\r\n */\r\nexport interface State {\r\n  [key: string]: any;\r\n}\r\n\r\n/**\r\n * 事件函数对象\r\n */\r\nexport interface Actions {\r\n  [key: string]: any;\r\n}\r\n\r\n/**\r\n * 计算函数\r\n */\r\nexport interface Computeds {\r\n  [key: string]: Function;\r\n}\r\n\r\nexport interface Options {\r\n  state?: State;\r\n  actions?: Actions;\r\n  computeds?: Computeds;\r\n  instructionPrefix?: string;\r\n  templateEvent?: string;\r\n}\r\n\r\nconst l = console.log;\r\n\r\nclass Aja {\r\n  /**\r\n   * * 模板变量保存的DOM\r\n   */\r\n  private _templateVariables: {\r\n    [key: string]: ChildNode | Element | HTMLElement;\r\n  } = {};\r\n\r\n  /**\r\n   * *  指令前缀\r\n   * [:for] [:if]\r\n   */\r\n  private _instructionPrefix: string = \":\";\r\n\r\n  /**\r\n   * <button (click)=\"setName($event)\">click me</button>\r\n   */\r\n  private _templateEvent: string = \"$event\";\r\n\r\n  /**\r\n   * * :if\r\n   */\r\n  private get _ifInstruction(): string {\r\n    return this._instructionPrefix + \"if\";\r\n  }\r\n  /**\r\n   * * :for\r\n   */\r\n  private get _forInstruction(): string {\r\n    return this._instructionPrefix + \"for\";\r\n  }\r\n\r\n  $store!: Store;\r\n\r\n  constructor(view: string | HTMLElement, options: Options) {\r\n    const root = createRoot(view);\r\n    if (root === null) return;\r\n    if (options.instructionPrefix)\r\n      this._instructionPrefix = options.instructionPrefix;\r\n    if (options.templateEvent) this._templateEvent = options.templateEvent;\r\n    this._proxyState(options);\r\n    this._define(root, this.$store);\r\n  }\r\n\r\n  private _define(root: HTMLElement, state: State): void {\r\n    const children = Array.from(root.childNodes);\r\n    for (let index = 0; index < children.length; index++) {\r\n      const childNode = children[index];\r\n\r\n      // dom节点\r\n      if (\r\n        childNode.nodeType === Node.ELEMENT_NODE ||\r\n        childNode.nodeType === Node.DOCUMENT_FRAGMENT_NODE\r\n      ) {\r\n        const htmlElement: HTMLElement = childNode as HTMLElement;\r\n\r\n        // 遍历节点属性\r\n        // :if权限最大\r\n        const attrs: Attr[] = Array.from(htmlElement.attributes);\r\n        let depath = true;\r\n        let ifAttr = attrs.find(({ name }) => name === this._ifInstruction);\r\n        if (ifAttr) {\r\n          const commentElement = document.createComment(\"\");\r\n          htmlElement.parentElement!.insertBefore(commentElement, htmlElement);\r\n          autorun(() => {\r\n            const show = this._getData(ifAttr!.value, state);\r\n            if (show) {\r\n              commentElement.after(htmlElement);\r\n              depath = true;\r\n              if (Array.from(childNode.childNodes).length) {\r\n                this._define(htmlElement, state);\r\n              }\r\n            } else {\r\n              htmlElement.replaceWith(commentElement);\r\n              depath = false;\r\n            }\r\n            commentElement.data = createIfCommentData(show);\r\n          });\r\n          htmlElement.removeAttribute(this._ifInstruction);\r\n        }\r\n\r\n        if (depath) {\r\n          for (const { name, value } of attrs) {\r\n            // [title]='xxx'\r\n            if (attrp(name)) {\r\n              let attrName = name\r\n                .replace(/^\\[/, emptyString)\r\n                .replace(/\\]$/, emptyString);\r\n              autorun(() => {\r\n                if (attrName === \"style\") {\r\n                  const styles: CSSStyleDeclaration = this._getData(\r\n                    value,\r\n                    state\r\n                  );\r\n                  for (const key in styles) {\r\n                    // 过滤掉无效的style\r\n                    if (\r\n                      Object.getOwnPropertyDescriptor(htmlElement.style, key) &&\r\n                      styles[key]\r\n                    ) {\r\n                      htmlElement.style[key] = styles[key];\r\n                    }\r\n                  }\r\n                } else {\r\n                  htmlElement.setAttribute(\r\n                    attrName,\r\n                    this._getData(value, state)\r\n                  ); // 属性扫描绑定\r\n                }\r\n              });\r\n              htmlElement.removeAttribute(name);\r\n            }\r\n\r\n            // (click)=\"echo('hello',$event)\"\r\n            if (eventp(name)) {\r\n              const eventName = name\r\n                .replace(/^\\(/, emptyString)\r\n                .replace(/\\)$/, emptyString);\r\n              // 函数名\r\n              let funcName: string = value;\r\n              // 函数参数\r\n              let args: string[] = [];\r\n              if (value.includes(\"(\")) {\r\n                // 带参数的函数\r\n                const index = value.indexOf(\"(\");\r\n                funcName = value.substr(0, index);\r\n                args = parseTemplateEventArgs(value);\r\n              }\r\n\r\n              childNode.addEventListener(eventName, e => {\r\n                //? 每次点击都需解析参数?\r\n                //! 如果只解析一次，那么模板变量需要提前声明, 并且模板变量不会更新!\r\n                if (this.$store.$actions && funcName in this.$store.$actions) {\r\n                  this.$store.$actions[funcName].apply(\r\n                    this.$store,\r\n                    this._parseArgsToArguments(args, e, state)\r\n                  );\r\n                }\r\n              });\r\n              htmlElement.removeAttribute(name);\r\n            }\r\n\r\n            if (tempvarp(name)) {\r\n              // 模板变量 #input\r\n              this._templateVariables[name.replace(/^#/, \"\")] = htmlElement;\r\n              htmlElement.removeAttribute(name);\r\n            }\r\n\r\n            // TODO 处理for指令\r\n            if (name === this._forInstruction) {\r\n              // 解析for指令的值\r\n              let [varb, d] = value.split(\"in\").map(s => s.trim());\r\n              if (!varb) return;\r\n              if (!isNaN(+d)) {\r\n                const fragment = document.createDocumentFragment();\r\n                htmlElement.removeAttribute(this._forInstruction);\r\n                for (let index = 0; index < +d; index++) {\r\n                  const item = childNode.cloneNode(true);\r\n                  this._define(item as HTMLElement, {\r\n                    ...state,\r\n                    [varb]: index\r\n                  });\r\n                  fragment.append(item);\r\n                }\r\n                childNode.replaceWith(fragment);\r\n              } else {\r\n                // TODO: 循环Object or Array\r\n              }\r\n            }\r\n          }\r\n          // 递归遍历\r\n          if (Array.from(childNode.childNodes).length) {\r\n            this._define(htmlElement, state);\r\n          }\r\n        }\r\n      } else if (childNode.nodeType === Node.TEXT_NODE) {\r\n        // 插值表达式 {{ name }} {{ obj.age }}\r\n        if (childNode.textContent) {\r\n          const exp = /{{([\\w\\s\\.][\\s\\w\\.]+)}}/g;\r\n          if (exp.test(childNode.textContent)) {\r\n            const _initTextContent = childNode.textContent;\r\n            autorun(() => {\r\n              const text = _initTextContent.replace(exp, (...args) => {\r\n                var key = args[1].replace(/\\s/g, \"\");\r\n                return this._getData(key, state);\r\n              });\r\n              childNode.textContent = text;\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private _proxyState(options: Options): void {\r\n    const state = createObject<State>(options.state);\r\n    const computeds = createObject<Computeds>(options.computeds);\r\n    const actions = createObject<Actions>(options.actions);\r\n\r\n    this.$store = new Store({ state, computeds, actions });\r\n  }\r\n\r\n  /**\r\n   * * 在state中寻找数据\r\n   * * 'name' 'object.name'\r\n   * ? 有限找模板变量的数据，再找state\r\n   * @param key\r\n   * @param state\r\n   */\r\n  private _getData(key: string, state: State): any {\r\n    if (typeof key !== \"string\") return null;\r\n    const keys = key.split(\".\");\r\n    let _result: any;\r\n\r\n    // 模板变量\r\n    if (keys[0] in this._templateVariables) {\r\n      for (const k of keys) {\r\n        _result = _result ? _result[k] : this._templateVariables[k];\r\n      }\r\n    }\r\n\r\n    // state\r\n    if (_result === undefined) {\r\n      for (const k of keys) {\r\n        _result = _result ? _result[k] : state[k];\r\n      }\r\n    }\r\n    return _result;\r\n  }\r\n\r\n  /**\r\n   * ['obj.age', 12, false, '\"   \"', alert('xxx')] -> [22, 12, false, \"   \", eval(<other>)]\r\n   * @param args\r\n   * @param e\r\n   * @param state\r\n   */\r\n  private _parseArgsToArguments(args: string[], e: Event, state: State) {\r\n    return args.map(arg => {\r\n      if (!arg) return arg;\r\n      let el = arg.trim();\r\n      if (el === this._templateEvent) return e;\r\n      if (isNumber(el)) return +arg;\r\n      if (isTemplateEmptyString(el)) return arg;\r\n      if (isTemplateString(el)) {\r\n        return el\r\n          .replace(/^./, emptyString)\r\n          .replace(/.$/, emptyString)\r\n          .toString();\r\n      }\r\n      const data = this._getData(el, state);\r\n      return data ? data : eval(el);\r\n    });\r\n  }\r\n}\r\n\r\nexport default Aja;\r\n"],"names":[],"mappings":"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"}